# 技术设计规范

## 一、设计概述（必须）

（用几句话描述总体的设计思想）

------



## 二、项目范围（必须）

(必须，确定项目变更的范围，列出详细的变更点)

------



## 三、系统架构（选填）

(根据项目的复杂程度决定是否提供)

(可选，系统上下游关系架构(包含外部依赖，数据存储)) (可选，系统内部组件关系图)

------



## 四、业务流程（选填）

关键流程，时序图 或 泳道图 (可选)关键业务，状态机/流程图/JOB设计



------



## 五、数据模型（有则必须）

(Mysql ES Mongodb Redis ...... ) 数据库ER图:

数据模型属性明细表:

| 字段 | 名称 | 类型   | 是否可为空 | 示例说明     |
| ---- | ---- | ------ | ---------- | ------------ |
| id   | 主键 | bigint | 否         | 主键自增长ID |
|      |      |        |            |              |

------



## 六、接口定义（有则必须）

(修改和新增的rest/rpc)

入参:

出参:

参数示例：

------



## 七、消息相关（有则必须）

生产者/消费者 producer consumer

队列名称 队列类型(Rabbit/Rocket/Redis/Beanstalk)

消息体 MessageDTO

MessageDTO字段说明:

------



## 八、外部依赖相关（有则必须）

- 外部接口依赖（提需求）

------



##  九、配置变更（可不写，项目提测的时候再补充）

| A           | B                                          |
| ----------- | ------------------------------------------ |
| 类别        | 内容                                       |
| 数据库变动  | 上线配置与SQL-sprint11                     |
| disconf配置 | 上线配置与SQL-sprint11                     |
| redis配置   | 大致写一下需要增加的数据结构，调用频次等等 |

------



## 十、稳定性&安全（选填，重要项目必填）

* 安全问题

  | A    | B                        | C    | D        |
  | ---- | ------------------------ | ---- | -------- |
  | 序号 | 安全问题                 | 结论 | 解决方案 |
  | 1    | 是否存在敏感信息泄露问题 |      |          |
  | 2    | 是否可能有越权访问问题   |      |          |

  

* 系统容量&性能指标&限流限制

| A      | B    | C    | D    | E    |
| ------ | ---- | ---- | ---- | ---- |
| 上下游 | 服务 | QPS  | RT   | 阈值 |
|        |      |      |      |      |

* 依赖关系梳理

| A           | B      | C            | D         | E        | F        |
| ----------- | ------ | ------------ | --------- | -------- | -------- |
| 依赖/被依赖 | 依赖方 | 服务接口名称 | 强/弱依赖 | 失败处理 | 降级处理 |
|             |        |              |           |          |          |

* 业务监控

| A            | B      | C        | D                     | E                         |
| ------------ | ------ | -------- | --------------------- | ------------------------- |
| 监控类型     | 异常数 | 响应时间 | 业务数据指标1(发送量) | 业务数据指标2(用户点击量) |
| 历史基线对比 |        |          |                       |                           |
| 实时数据     |        |          |                       |                           |

* 业务关键场景的QPS/RT/错误监控，非REST/RPC级;



* 故障影响与应对

| A      | B        | C        | D        | E        |
| ------ | -------- | -------- | -------- | -------- |
| 故障源 | 服务名称 | 影响服务 | 影响服务 | 处理措施 |
|        |          |          |          |          |



* (依赖方故障、自身故障)将影响到用户哪些业务



* 业务降级:

| A        | B        |
| -------- | -------- |
| 降级手段 | 影响说明 |
|          |          |



* 开关手动降级(如:关闭sendMsg的调用)，超时/错误的自动降级(限流延迟处理)



* 灰度方案

| A          | B                    |
| ---------- | -------------------- |
| 灰度策略   | 影响说明             |
| 白名单     | 按白名单列表进行灰度 |
| userId%100 | 按用户流量百分比灰度 |

***



## 十一、 兼容性

- 历史数据(只处理新数据时需要考虑) 历史app版本
- 老接口兼容
- MQ 消息兼容(切换queue或者，切换mq时需要考虑)