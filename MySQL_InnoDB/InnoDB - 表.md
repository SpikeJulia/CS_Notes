## InnoDB - 表

### 1、索引组织表

* 根据主键顺序组织存放的叫索引组织表；
* InnoDB存储引擎表中，必有主键；创建表时，没有显示定义，会自动选择或创建主键：
  * 表中是否有非空的唯一索引，有则为主键；
  * 否则，自动创建一个6字节大小的指针为主键。
* 查看主键命令：SELECT a,b,c,_rowid FROM z;  abc为列名，__rowid 为查询的主键列

***

### 2、InnoDB 逻辑存储结构

* 所有数据都被逻辑地存放再一个表空间中，表空间由 段(segment)、区(extent)、页(page)组成；
* ![存储结构](E:\cmder\A_CS_NOTES\CS_Notes\MySQL_InnoDB\存储结构.png)

***

***

### 2.1、表空间

* 表空间是InnoDB存储引擎逻辑结构最高层，所有数据都放在表空间中；
* 默认情况下有一个共享的表空间——ibdata1,  所有数据都放在其中；
* 启用 innodb_file_per_table，则每张表内的数据都单独存放到一个表空间，仅是数据、索引和插入缓冲Bitmap页；
* 其他类数据，如回滚信息，插入缓冲索引页，系统事务信息，二次写缓冲等还是在 ibdata1中。

***

### 2.2、段

* 数据段：B+树的叶子节点
* 索引段：B+树的非叶子节点
* 回滚段

***

### 2.3、区

* 区是连续的页构成，任何情况大小为 1M
* 默认页大小为16k，即一个区有64个连续的页
* 引入压缩页后，2、4、8K大小

***

### 2.4、页

* 默认大小16K
* 数据页(B-tree Node)
* undo页(undo Log Page)
* 系统页(System Page)
* 事务数据页(Transaction system Page)
* 插入缓冲位图页(Insert Buffer Free List)
* 插入缓冲空闲列表页(Insert Buffer Free List)
* 未压缩的二进制大对象页(Uncompressed BLOB Page)
* 压缩的二进制大对象页(compressed BLOB Page)

***

### 2.5、行

* InnoDB面向列的，数据按行存放
* 每页存放行记录有限制，最多(16KB/ 2byte)-200 = 7992行
* 200行为预留行数

***

### 2.6、行记录格式

**1.0.x版本之前：**

* Compact 格式: 目前使用最多的格式，一个页中行数据越多，性能越高

* 若列长度小于255字节，用1字节表示；

* 大于则用2字节，最大不可超过2字节，因为VARCHAR类型；

  |             |            |            |         |         |        |
  | :----------: | :-------: | :--------: | :-----: | :-----: | ------ |
  | 变长字段长度列表 | NULL标志位 | 记录头信息 | 列1数据 | 列2数据 | ...... |

  

